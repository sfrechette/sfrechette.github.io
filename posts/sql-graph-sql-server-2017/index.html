<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="St√©phane Fr√©chette">
    <meta name="description" content="St√©phane Fr√©chette&#39;s personal website">
    <meta name="keywords" content="stephane frechette,blog,data engineer,cloud solution architect,google cloud">

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="SQL Graph in SQL Server 2017"/>
<meta name="twitter:description" content="As I mentioned several times before‚Ä¶ Graphs are everywhere! Graph features are being introduced in SQL Server 2017. Offering graph database capabilities to model many-to-many relationships. The graph relationships are integrated into Transact-SQL and receive the benefits of using SQL Server as the foundational database management system.
What is a graph database? In context, a graph database is a database that uses graph structures for semantic queries with nodes, edges and properties to represent and store data."/>

    <meta property="og:title" content="SQL Graph in SQL Server 2017" />
<meta property="og:description" content="As I mentioned several times before‚Ä¶ Graphs are everywhere! Graph features are being introduced in SQL Server 2017. Offering graph database capabilities to model many-to-many relationships. The graph relationships are integrated into Transact-SQL and receive the benefits of using SQL Server as the foundational database management system.
What is a graph database? In context, a graph database is a database that uses graph structures for semantic queries with nodes, edges and properties to represent and store data." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://stephanefrechette.dev/posts/sql-graph-sql-server-2017/" />
<meta property="article:published_time" content="2017-05-16T09:35:21-04:00" />
<meta property="article:modified_time" content="2017-05-16T09:35:21-04:00" />


    
      <base href="https://stephanefrechette.dev/posts/sql-graph-sql-server-2017/">
    
    <title>
  SQL Graph in SQL Server 2017 ¬∑ St√©phane Fr√©chette
</title>

    
      <link rel="canonical" href="https://stephanefrechette.dev/posts/sql-graph-sql-server-2017/">
    

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css" integrity="sha256-oSrCnRYXvHG31SBifqP2PM1uje7SJUyX0nTwO2RJV54=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="https://stephanefrechette.dev/css/coder.min.28d751104f30c16da1aa1bb04015cbe662cacfe0d1b01af4f2240ad58580069c.css" integrity="sha256-KNdREE8wwW2hqhuwQBXL5mLKz&#43;DRsBr08iQK1YWABpw=" crossorigin="anonymous" media="screen" />
    

    

    

    
      <link rel="stylesheet" href="https://stephanefrechette.dev/css/custom.css">
    

    <link rel="icon" type="image/png" href="https://stephanefrechette.dev/images/me-cartoon-32x32.jpg" sizes="32x32">
    <link rel="icon" type="image/png" href="https://stephanefrechette.dev/images/me-cartoon-16x16.jpg" sizes="16x16">

    <meta name="generator" content="Hugo 0.61.0" />
  </head>

  <body class=" ">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://stephanefrechette.dev">
      St√©phane Fr√©chette
    </a>
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://stephanefrechette.dev/posts/">Blog</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://stephanefrechette.dev/talks/">Talks</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://stephanefrechette.dev/about/">About</a>
          </li>
        
      
      
    </ul>
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">SQL Graph in SQL Server 2017</h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fas fa-calendar"></i>
              <time datetime='2017-05-16T09:35:21-04:00'>
                May 16, 2017
              </time>
            </span>
            <span class="reading-time">
              <i class="fas fa-clock"></i>
              6 minutes read
            </span>
          </div>
          <div class="categories">
  <i class="fas fa-folder"></i>
    <a href="https://stephanefrechette.dev/categories/databases/">Databases</a></div>

          <div class="tags">
  <i class="fas fa-tag"></i>
    <a href="https://stephanefrechette.dev/tags/graph-database/">graph database</a>
      <span class="separator">‚Ä¢</span>
    <a href="https://stephanefrechette.dev/tags/sql-graph/">sql graph</a>
      <span class="separator">‚Ä¢</span>
    <a href="https://stephanefrechette.dev/tags/sql-server/">sql server</a>
      <span class="separator">‚Ä¢</span>
    <a href="https://stephanefrechette.dev/tags/sql-server-2017/">sql server 2017</a></div>

        </div>
      </header>
      
      <div>
        <p><figure>
    <img src="https://stephanefrechette.dev/images/legacy-post/6n-graf.svg_-300x198.png" width="300" height="198"/> 
</figure>
 As I mentioned several times before‚Ä¶ Graphs are everywhere! Graph features are being introduced in SQL Server 2017. Offering graph database capabilities to model many-to-many relationships. The graph relationships are integrated into Transact-SQL and receive the benefits of using SQL Server as the foundational database management system.</p>
<h4 id="what-is-a-graph-database">What is a graph database?</h4>
<p>In context, a graph database is a database that uses graph structures for semantic queries with <strong>nodes</strong>, <strong>edges</strong> and <strong>properties</strong> to represent and store data. A key concept of the system is the graph (or edge or relationship), which directly relates data items in the store. The relationships allow data in the store to be linked together directly‚Ä¶</p>
<h4 id="whats-is-a-sql-graph-in-sql-server-2017">Whats is a SQL Graph in SQL Server 2017?</h4>
<p>A collection of node and edge tables. Node or edge tables can be created under any schema in the database, but they all belong to one logical graph. Only one graph can be created per database.</p>
<p>Key concepts:</p>
<ul>
<li>A node table represents an entity in a graph schema.</li>
<li>An edge table represents a relationship in a graph. Edges are always directed and connect two nodes. An edge table enables users to model many-to-many relationships in the graph. An edge table may or may not have any user defined attributes in it.</li>
</ul>
<p>I strongly recommend you read the following -&gt; <!-- raw HTML omitted -->SQL Graph Architecture<!-- raw HTML omitted --> to learn how SQL Graph is architected.</p>
<p>You can also refer to previous <a href="https://stephanefrechette.com/?s=neo4j">blog posts</a> I did about <a href="https://neo4j.com/">Neo4j</a> (which I am big fan) to understand other key concepts about Graph databases.</p>
<h4 id="let8217s-demo-this">Let‚Äôs demo this</h4>
<p>We will use a dataset inspired from <!-- raw HTML omitted -->CraftCans.com<!-- raw HTML omitted -->  <!-- raw HTML omitted -->a site dedicated <!-- raw HTML omitted --> was a site dedicated to news and reviews for the ‚ÄúCanned Beer Revolution‚Äù. It also contains a database of all canned craft beers available in the US which I scraped and slightly modified for our needs. I love beer, but for those who don‚Äôt know me well I prefer wine üòâ</p>
<p>First assumption is that you have already downloaded and installed <!-- raw HTML omitted -->SQL Server 2017 CTP 2.0<!-- raw HTML omitted -->.<br>
Then you will need to execute the following SQL script <!-- raw HTML omitted -->CraftCans.sql<!-- raw HTML omitted --> that will create the CraftCans relational database with all the required objects and load data into tables.</p>
<p>The CraftCans Relational Model:<br>
<figure>
    <img src="https://stephanefrechette.dev/images/legacy-post/erd_01-1.png" width="472" height="510"/> 
</figure>
</p>
<p>Now on to modeling our graph‚Ä¶ I created the following property graph model to represent information about our CraftCans Graph. The property graph model is an extension of the graphs from mathematics. Property graphs provide finer-granularity on the meaning of nodes and edges (it‚Äôs the equivalent of an ERD ‚Äì Entity Relationship Diagram but for Graphs)</p>
<p>CraftCans Property Graph Model:<br>
<figure>
    <img src="https://stephanefrechette.dev/images/legacy-post/craftcans_propertygraph.png" width="876" height="337"/> 
</figure>
</p>
<p>First we need to create the nodes and appropriate indexes</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">use CraftCans;
<span style="color:#007020;font-weight:bold">go</span>

<span style="color:#007020;font-weight:bold">create</span> <span style="color:#007020;font-weight:bold">schema</span> graph;
<span style="color:#007020;font-weight:bold">go</span>

<span style="color:#60a0b0;font-style:italic">/*</span><span style="color:#60a0b0;font-style:italic">----------------------------------------------------
</span><span style="color:#60a0b0;font-style:italic">Create NODE tables
</span><span style="color:#60a0b0;font-style:italic">----------------------------------------------------</span><span style="color:#60a0b0;font-style:italic">*/</span>

<span style="color:#60a0b0;font-style:italic">--Beer
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#007020;font-weight:bold">create</span> <span style="color:#007020;font-weight:bold">table</span> graph.Beer
(
	id			<span style="color:#007020">int</span> <span style="color:#007020;font-weight:bold">primary</span> <span style="color:#007020;font-weight:bold">key</span>,
	[name]		nvarchar(<span style="color:#40a070">75</span>),
	ounces		nvarchar(<span style="color:#40a070">5</span>), 
	abv			nvarchar(<span style="color:#40a070">5</span>),
	ibu			nvarchar(<span style="color:#40a070">5</span>)
) <span style="color:#007020;font-weight:bold">as</span> node;

<span style="color:#007020;font-weight:bold">create</span> nonclustered <span style="color:#007020;font-weight:bold">index</span> idx_Beer_name <span style="color:#007020;font-weight:bold">on</span> graph.Beer ([name]);
<span style="color:#007020;font-weight:bold">create</span> nonclustered <span style="color:#007020;font-weight:bold">index</span> idx_Beer_ounces <span style="color:#007020;font-weight:bold">on</span> graph.Beer (ounces);
<span style="color:#007020;font-weight:bold">create</span> nonclustered <span style="color:#007020;font-weight:bold">index</span> idx_Beer_abv <span style="color:#007020;font-weight:bold">on</span> graph.Beer (abv);
<span style="color:#007020;font-weight:bold">create</span> nonclustered <span style="color:#007020;font-weight:bold">index</span> idx_Beer_ibu <span style="color:#007020;font-weight:bold">on</span> graph.Beer (ibu);

<span style="color:#60a0b0;font-style:italic">--Brewery
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#007020;font-weight:bold">create</span> <span style="color:#007020;font-weight:bold">table</span> graph.Brewery
(
	id			<span style="color:#007020">int</span> <span style="color:#007020;font-weight:bold">primary</span> <span style="color:#007020;font-weight:bold">key</span>,
	[name]		nvarchar(<span style="color:#40a070">50</span>)
) <span style="color:#007020;font-weight:bold">as</span> node;

<span style="color:#007020;font-weight:bold">create</span> nonclustered <span style="color:#007020;font-weight:bold">index</span> idx_Brewery_name <span style="color:#007020;font-weight:bold">on</span> graph.Brewery([name]);

<span style="color:#60a0b0;font-style:italic">--City
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#007020;font-weight:bold">create</span> <span style="color:#007020;font-weight:bold">table</span> graph.City
(
	id			<span style="color:#007020">int</span> <span style="color:#007020;font-weight:bold">primary</span> <span style="color:#007020;font-weight:bold">key</span>,
	[name]		nvarchar(<span style="color:#40a070">40</span>)
) <span style="color:#007020;font-weight:bold">as</span> node;

<span style="color:#007020;font-weight:bold">create</span> nonclustered <span style="color:#007020;font-weight:bold">index</span> idx_City_name <span style="color:#007020;font-weight:bold">on</span> graph.City([name]);

<span style="color:#60a0b0;font-style:italic">--State
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#007020;font-weight:bold">create</span> <span style="color:#007020;font-weight:bold">table</span> graph.[<span style="color:#007020;font-weight:bold">State</span>]
(
	id			<span style="color:#007020;font-weight:bold">nchar</span>(<span style="color:#40a070">2</span>) <span style="color:#007020;font-weight:bold">primary</span> <span style="color:#007020;font-weight:bold">key</span>,
	[name]		nvarchar(<span style="color:#40a070">20</span>)
) <span style="color:#007020;font-weight:bold">as</span> node;

<span style="color:#007020;font-weight:bold">create</span> nonclustered <span style="color:#007020;font-weight:bold">index</span> idx_State_name <span style="color:#007020;font-weight:bold">on</span> graph.[<span style="color:#007020;font-weight:bold">State</span>]([name]);

<span style="color:#60a0b0;font-style:italic">--Style
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#007020;font-weight:bold">create</span> <span style="color:#007020;font-weight:bold">table</span> graph.Style
(
	id			<span style="color:#007020">int</span> <span style="color:#007020;font-weight:bold">primary</span> <span style="color:#007020;font-weight:bold">key</span>,
	[name]		nvarchar(<span style="color:#40a070">40</span>)
) <span style="color:#007020;font-weight:bold">as</span> node;

<span style="color:#007020;font-weight:bold">create</span> nonclustered <span style="color:#007020;font-weight:bold">index</span> idx_Style_name <span style="color:#007020;font-weight:bold">on</span> graph.Style([name]);
</code></pre></div><p>Then we create the edges with appropriate indexes</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#60a0b0;font-style:italic">/*</span><span style="color:#60a0b0;font-style:italic">----------------------------------------------------
</span><span style="color:#60a0b0;font-style:italic">Create EDGE tables
</span><span style="color:#60a0b0;font-style:italic">----------------------------------------------------</span><span style="color:#60a0b0;font-style:italic">*/</span>

<span style="color:#60a0b0;font-style:italic">--BREWED_BY
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#007020;font-weight:bold">create</span> <span style="color:#007020;font-weight:bold">table</span> graph.BREWED_BY <span style="color:#007020;font-weight:bold">as</span> edge;
<span style="color:#007020;font-weight:bold">create</span> <span style="color:#007020;font-weight:bold">unique</span> nonclustered <span style="color:#007020;font-weight:bold">index</span> idx_BREWED_BY_from_id_to_id <span style="color:#007020;font-weight:bold">on</span> graph.BREWED_BY (<span style="">$</span>from_id, <span style="">$</span>to_id);

<span style="color:#60a0b0;font-style:italic">--BEER_STYLE
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#007020;font-weight:bold">create</span> <span style="color:#007020;font-weight:bold">table</span> graph.BEER_STYLE <span style="color:#007020;font-weight:bold">as</span> edge;
<span style="color:#007020;font-weight:bold">create</span> <span style="color:#007020;font-weight:bold">unique</span> nonclustered <span style="color:#007020;font-weight:bold">index</span> idx_BEER_STYLE_from_id_to_id <span style="color:#007020;font-weight:bold">on</span> graph.BEER_STYLE (<span style="">$</span>from_id, <span style="">$</span>to_id);

<span style="color:#60a0b0;font-style:italic">--LOCATED_IN
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#007020;font-weight:bold">create</span> <span style="color:#007020;font-weight:bold">table</span> graph.LOCATED_IN <span style="color:#007020;font-weight:bold">as</span> edge;
<span style="color:#007020;font-weight:bold">create</span> <span style="color:#007020;font-weight:bold">unique</span> nonclustered <span style="color:#007020;font-weight:bold">index</span> idx_LOCATED_IN_from_id_to_id <span style="color:#007020;font-weight:bold">on</span> graph.LOCATED_IN (<span style="">$</span>from_id, <span style="">$</span>to_id);

<span style="color:#60a0b0;font-style:italic">--IN_STATE
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#007020;font-weight:bold">create</span> <span style="color:#007020;font-weight:bold">table</span> graph.IN_STATE <span style="color:#007020;font-weight:bold">as</span> edge;
<span style="color:#007020;font-weight:bold">create</span> <span style="color:#007020;font-weight:bold">unique</span> nonclustered <span style="color:#007020;font-weight:bold">index</span> idx_IN_STATE_from_id_to_id <span style="color:#007020;font-weight:bold">on</span> graph.IN_STATE (<span style="">$</span>from_id, <span style="">$</span>to_id);
</code></pre></div><p>We then load data into the nodes and edges tables from the relational CraftCans database model</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#60a0b0;font-style:italic">/*</span><span style="color:#60a0b0;font-style:italic">----------------------------------------------------
</span><span style="color:#60a0b0;font-style:italic">Insert data into NODE tables
</span><span style="color:#60a0b0;font-style:italic">----------------------------------------------------</span><span style="color:#60a0b0;font-style:italic">*/</span>

<span style="color:#60a0b0;font-style:italic">--Beer
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#007020;font-weight:bold">insert</span> <span style="color:#007020;font-weight:bold">into</span> graph.Beer
	<span style="color:#007020;font-weight:bold">select</span>	BeerID, 
			BeerName, 
			Ounces,
			ABV, 
			IBU
	<span style="color:#007020;font-weight:bold">from</span>	dbo.Beer;

<span style="color:#60a0b0;font-style:italic">--Brewery
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#007020;font-weight:bold">insert</span> <span style="color:#007020;font-weight:bold">into</span> graph.Brewery
	<span style="color:#007020;font-weight:bold">select</span>	BreweryID, 
			BreweryName
	<span style="color:#007020;font-weight:bold">from</span>	dbo.Brewery;

<span style="color:#60a0b0;font-style:italic">--City
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#007020;font-weight:bold">insert</span> <span style="color:#007020;font-weight:bold">into</span> graph.City
	<span style="color:#007020;font-weight:bold">select</span>	CityID, 
			CityName
	<span style="color:#007020;font-weight:bold">from</span>	dbo.City;

<span style="color:#60a0b0;font-style:italic">--State
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#007020;font-weight:bold">insert</span> <span style="color:#007020;font-weight:bold">into</span> graph.[<span style="color:#007020;font-weight:bold">State</span>]
	<span style="color:#007020;font-weight:bold">select</span>	StateCode, 
			StateName
	<span style="color:#007020;font-weight:bold">from</span>	dbo.[<span style="color:#007020;font-weight:bold">State</span>];

<span style="color:#60a0b0;font-style:italic">--Style
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#007020;font-weight:bold">insert</span> <span style="color:#007020;font-weight:bold">into</span> graph.Style
	<span style="color:#007020;font-weight:bold">select</span>	StyleID, 
			StyleName
	<span style="color:#007020;font-weight:bold">from</span>	dbo.Style;

<span style="color:#60a0b0;font-style:italic">/*</span><span style="color:#60a0b0;font-style:italic">----------------------------------------------------
</span><span style="color:#60a0b0;font-style:italic">Insert data into EDGE tables
</span><span style="color:#60a0b0;font-style:italic">----------------------------------------------------</span><span style="color:#60a0b0;font-style:italic">*/</span>

<span style="color:#60a0b0;font-style:italic">--BEER_STYLE
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#007020;font-weight:bold">insert</span> <span style="color:#007020;font-weight:bold">into</span> graph.BEER_STYLE
	<span style="color:#007020;font-weight:bold">select</span>	g_b.<span style="">$</span>node_id <span style="color:#007020;font-weight:bold">as</span> <span style="color:#4070a0">&#39;</span><span style="color:#4070a0">from_id</span><span style="color:#4070a0">&#39;</span>, 
			g_s.<span style="">$</span>node_id <span style="color:#007020;font-weight:bold">as</span> <span style="color:#4070a0">&#39;</span><span style="color:#4070a0">to_id</span><span style="color:#4070a0">&#39;</span>
	<span style="color:#007020;font-weight:bold">from</span>	dbo.Beer b <span style="color:#007020;font-weight:bold">join</span>
			dbo.Style s <span style="color:#007020;font-weight:bold">on</span> b.StyleID <span style="color:#666">=</span> s.StyleID <span style="color:#007020;font-weight:bold">join</span>
			graph.Beer g_b <span style="color:#007020;font-weight:bold">on</span> b.BeerID <span style="color:#666">=</span> g_b.id <span style="color:#007020;font-weight:bold">join</span>
			graph.Style g_s <span style="color:#007020;font-weight:bold">on</span> s.StyleID <span style="color:#666">=</span> g_s.id;

<span style="color:#60a0b0;font-style:italic">--BREWED_BY
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#007020;font-weight:bold">insert</span> <span style="color:#007020;font-weight:bold">into</span> graph.BREWED_BY
	<span style="color:#007020;font-weight:bold">select</span>	g_b.<span style="">$</span>node_id <span style="color:#007020;font-weight:bold">as</span> <span style="color:#4070a0">&#39;</span><span style="color:#4070a0">from_id</span><span style="color:#4070a0">&#39;</span>,
			g_br.<span style="">$</span>node_id <span style="color:#007020;font-weight:bold">as</span> <span style="color:#4070a0">&#39;</span><span style="color:#4070a0">to_id</span><span style="color:#4070a0">&#39;</span>
	<span style="color:#007020;font-weight:bold">from</span>	dbo.Beer b <span style="color:#007020;font-weight:bold">join</span>
			dbo.Brewery br <span style="color:#007020;font-weight:bold">on</span> b.BreweryID <span style="color:#666">=</span> br.BreweryID <span style="color:#007020;font-weight:bold">join</span>
			graph.Beer g_b <span style="color:#007020;font-weight:bold">on</span> b.BeerID <span style="color:#666">=</span> g_b.id <span style="color:#007020;font-weight:bold">join</span>
			graph.Brewery g_br <span style="color:#007020;font-weight:bold">on</span> br.BreweryID <span style="color:#666">=</span> g_br.id;

<span style="color:#60a0b0;font-style:italic">--LOCATED_IN
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#007020;font-weight:bold">insert</span> <span style="color:#007020;font-weight:bold">into</span> graph.LOCATED_IN
	<span style="color:#007020;font-weight:bold">select</span>	g_br.<span style="">$</span>node_id <span style="color:#007020;font-weight:bold">as</span> <span style="color:#4070a0">&#39;</span><span style="color:#4070a0">from_id</span><span style="color:#4070a0">&#39;</span>,
			g_c.<span style="">$</span>node_id <span style="color:#007020;font-weight:bold">as</span> <span style="color:#4070a0">&#39;</span><span style="color:#4070a0">to_id</span><span style="color:#4070a0">&#39;</span>
	<span style="color:#007020;font-weight:bold">from</span>	dbo.City <span style="color:#007020;font-weight:bold">c</span> <span style="color:#007020;font-weight:bold">join</span>
			dbo.Brewery br <span style="color:#007020;font-weight:bold">on</span> <span style="color:#007020;font-weight:bold">c</span>.CityID <span style="color:#666">=</span> br.CityID <span style="color:#007020;font-weight:bold">join</span>
			graph.Brewery g_br <span style="color:#007020;font-weight:bold">on</span> br.BreweryID <span style="color:#666">=</span> g_br.id <span style="color:#007020;font-weight:bold">join</span>
			graph.City g_c <span style="color:#007020;font-weight:bold">on</span> <span style="color:#007020;font-weight:bold">c</span>.CityID <span style="color:#666">=</span> g_c.id;

<span style="color:#60a0b0;font-style:italic">--IN_STATE
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#007020;font-weight:bold">insert</span> <span style="color:#007020;font-weight:bold">into</span> graph.IN_STATE
	<span style="color:#007020;font-weight:bold">select</span>	g_c.<span style="">$</span>node_id <span style="color:#007020;font-weight:bold">as</span> <span style="color:#4070a0">&#39;</span><span style="color:#4070a0">from_id</span><span style="color:#4070a0">&#39;</span>,
			g_s.<span style="">$</span>node_id <span style="color:#007020;font-weight:bold">as</span> <span style="color:#4070a0">&#39;</span><span style="color:#4070a0">to_id</span><span style="color:#4070a0">&#39;</span>
	<span style="color:#007020;font-weight:bold">from</span>	dbo.[<span style="color:#007020;font-weight:bold">State</span>] s <span style="color:#007020;font-weight:bold">join</span>
			dbo.City <span style="color:#007020;font-weight:bold">c</span> <span style="color:#007020;font-weight:bold">on</span> s.StateCode <span style="color:#666">=</span> <span style="color:#007020;font-weight:bold">c</span>.StateCode <span style="color:#007020;font-weight:bold">join</span>
			graph.[<span style="color:#007020;font-weight:bold">State</span>] g_s <span style="color:#007020;font-weight:bold">on</span> s.StateCode <span style="color:#666">=</span> g_s.id <span style="color:#007020;font-weight:bold">join</span>
			graph.City g_c <span style="color:#007020;font-weight:bold">on</span> <span style="color:#007020;font-weight:bold">c</span>.CityID <span style="color:#666">=</span> g_c.id;
</code></pre></div><p>Here is a screenshot of the CraftCans database once we have created our graph model:</p>
<figure>
    <img src="https://stephanefrechette.dev/images/legacy-post/db_01-1.png" width="243" height="400"/> 
</figure>

<p>That‚Äôs it! We are now ready to query our graph model. The following are sample queries to explore our model, I also recommend you read the following page <!-- raw HTML omitted -->Create a graph database and run some pattern matching queries using T-SQL<!-- raw HTML omitted --> to further understand the <strong>MATCH</strong> command that enables to match a pattern or traverse through the graph.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#60a0b0;font-style:italic">/*</span><span style="color:#60a0b0;font-style:italic">----------------------------------------------------
</span><span style="color:#60a0b0;font-style:italic">Queries
</span><span style="color:#60a0b0;font-style:italic">----------------------------------------------------</span><span style="color:#60a0b0;font-style:italic">*/</span>

<span style="color:#60a0b0;font-style:italic">--Return beers brewed by &#39;Petoskey Brewing&#39; brewing company
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#007020;font-weight:bold">select</span>	Beer.[name] <span style="color:#007020;font-weight:bold">as</span> <span style="color:#4070a0">&#39;</span><span style="color:#4070a0">Beer</span><span style="color:#4070a0">&#39;</span>
<span style="color:#007020;font-weight:bold">from</span>	graph.Beer, graph.BREWED_BY, graph.Brewery
<span style="color:#007020;font-weight:bold">where</span>	<span style="color:#007020;font-weight:bold">match</span> (Beer<span style="color:#666">-</span>(BREWED_BY)<span style="color:#666">-</span><span style="color:#666">&gt;</span>Brewery) <span style="color:#007020;font-weight:bold">and</span>
		Brewery.[name] <span style="color:#666">=</span> <span style="color:#4070a0">&#39;</span><span style="color:#4070a0">Petoskey Brewing</span><span style="color:#4070a0">&#39;</span>

<span style="color:#60a0b0;font-style:italic">--Return beers and breweries located in Seattle
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#007020;font-weight:bold">select</span>	Beer.[name] <span style="color:#007020;font-weight:bold">as</span> <span style="color:#4070a0">&#39;</span><span style="color:#4070a0">Beer</span><span style="color:#4070a0">&#39;</span>, 
		Brewery.[name] <span style="color:#007020;font-weight:bold">as</span> <span style="color:#4070a0">&#39;</span><span style="color:#4070a0">Brewery</span><span style="color:#4070a0">&#39;</span>
<span style="color:#007020;font-weight:bold">from</span>	graph.Beer, graph.BREWED_BY, graph.Brewery, graph.LOCATED_IN, graph.City
<span style="color:#007020;font-weight:bold">where</span>	<span style="color:#007020;font-weight:bold">match</span> (Beer<span style="color:#666">-</span>(BREWED_BY)<span style="color:#666">-</span><span style="color:#666">&gt;</span>Brewery<span style="color:#666">-</span>(LOCATED_IN)<span style="color:#666">-</span><span style="color:#666">&gt;</span>City) <span style="color:#007020;font-weight:bold">and</span>
		City.[name] <span style="color:#666">=</span> <span style="color:#4070a0">&#39;</span><span style="color:#4070a0">Seattle</span><span style="color:#4070a0">&#39;</span>

<span style="color:#60a0b0;font-style:italic">--Return style of beers and breweries located in Anchorage
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#007020;font-weight:bold">select</span>	Beer.[name] <span style="color:#007020;font-weight:bold">as</span> <span style="color:#4070a0">&#39;</span><span style="color:#4070a0">Beer</span><span style="color:#4070a0">&#39;</span>,
		Style.[name] <span style="color:#007020;font-weight:bold">as</span> <span style="color:#4070a0">&#39;</span><span style="color:#4070a0">Style</span><span style="color:#4070a0">&#39;</span>, 
		Brewery.[name] <span style="color:#007020;font-weight:bold">as</span> <span style="color:#4070a0">&#39;</span><span style="color:#4070a0">Brewery</span><span style="color:#4070a0">&#39;</span>
<span style="color:#007020;font-weight:bold">from</span>	graph.Style, graph.BEER_STYLE, graph.Beer, graph.BREWED_BY, graph.Brewery, graph.LOCATED_IN, graph.City
<span style="color:#007020;font-weight:bold">where</span>	<span style="color:#007020;font-weight:bold">match</span> (Style<span style="color:#666">&amp;</span>lt; <span style="color:#666">-</span>(BEER_STYLE)<span style="color:#666">-</span>Beer<span style="color:#666">-</span>(BREWED_BY)<span style="color:#666">-</span><span style="color:#666">&gt;</span>Brewery<span style="color:#666">-</span>(LOCATED_IN)<span style="color:#666">-</span><span style="color:#666">&gt;</span>City) <span style="color:#007020;font-weight:bold">and</span>
		City.[name] <span style="color:#666">=</span> <span style="color:#4070a0">&#39;</span><span style="color:#4070a0">Anchorage</span><span style="color:#4070a0">&#39;</span>

<span style="color:#60a0b0;font-style:italic">--Return all beer properties where style of beer is &#39;Irish Dry Stout&#39;
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#007020;font-weight:bold">select</span>	Beer.[name] <span style="color:#007020;font-weight:bold">as</span> <span style="color:#4070a0">&#39;</span><span style="color:#4070a0">Beer</span><span style="color:#4070a0">&#39;</span>,
		Beer.ounces <span style="color:#007020;font-weight:bold">as</span> <span style="color:#4070a0">&#39;</span><span style="color:#4070a0">Ounces</span><span style="color:#4070a0">&#39;</span>,
		Beer.abv <span style="color:#007020;font-weight:bold">as</span> <span style="color:#4070a0">&#39;</span><span style="color:#4070a0">Alcohol By Volume</span><span style="color:#4070a0">&#39;</span>,
		Beer.ibu <span style="color:#007020;font-weight:bold">as</span> <span style="color:#4070a0">&#39;</span><span style="color:#4070a0">International Bitter Units</span><span style="color:#4070a0">&#39;</span>
<span style="color:#007020;font-weight:bold">from</span>	graph.Style, graph.BEER_STYLE, graph.Beer
<span style="color:#007020;font-weight:bold">where</span>	<span style="color:#007020;font-weight:bold">match</span> (Style<span style="color:#666">&amp;</span>lt; <span style="color:#666">-</span>(BEER_STYLE)<span style="color:#666">-</span>Beer) <span style="color:#007020;font-weight:bold">and</span>
		Style.[name] <span style="color:#666">=</span> <span style="color:#4070a0">&#39;</span><span style="color:#4070a0">Irish Dry Stout</span><span style="color:#4070a0">&#39;</span>

<span style="color:#60a0b0;font-style:italic">--Returns the count of beers by style
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#007020;font-weight:bold">select</span>	Style.[name] <span style="color:#007020;font-weight:bold">as</span> <span style="color:#4070a0">&#39;</span><span style="color:#4070a0">Style</span><span style="color:#4070a0">&#39;</span>,
		<span style="color:#007020;font-weight:bold">count</span>(Beer.id) <span style="color:#007020;font-weight:bold">as</span> <span style="color:#4070a0">&#39;</span><span style="color:#4070a0">Number of Beers</span><span style="color:#4070a0">&#39;</span>
<span style="color:#007020;font-weight:bold">from</span>	graph.Beer, graph.BEER_STYLE, graph.Style
<span style="color:#007020;font-weight:bold">where</span>	<span style="color:#007020;font-weight:bold">match</span> (Beer<span style="color:#666">-</span>(BEER_STYLE)<span style="color:#666">-</span><span style="color:#666">&gt;</span>Style)
<span style="color:#007020;font-weight:bold">group</span> <span style="color:#007020;font-weight:bold">by</span>
		Style.[name] 
<span style="color:#007020;font-weight:bold">order</span> <span style="color:#007020;font-weight:bold">by</span>
		[<span style="color:#007020">Number</span> <span style="color:#007020;font-weight:bold">of</span> Beers] <span style="color:#007020;font-weight:bold">desc</span>

<span style="color:#60a0b0;font-style:italic">--Returns the count of breweries by state
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#007020;font-weight:bold">select</span>	[<span style="color:#007020;font-weight:bold">State</span>].[name] <span style="color:#007020;font-weight:bold">as</span> <span style="color:#4070a0">&#39;</span><span style="color:#4070a0">State</span><span style="color:#4070a0">&#39;</span>,
		<span style="color:#007020;font-weight:bold">count</span>(Brewery.id) <span style="color:#007020;font-weight:bold">as</span> <span style="color:#4070a0">&#39;</span><span style="color:#4070a0">Number of Breweries</span><span style="color:#4070a0">&#39;</span>
<span style="color:#007020;font-weight:bold">from</span>	graph.Brewery, graph.LOCATED_IN, graph.City, graph.IN_STATE, graph.[<span style="color:#007020;font-weight:bold">State</span>]
<span style="color:#007020;font-weight:bold">where</span>	<span style="color:#007020;font-weight:bold">match</span> (Brewery<span style="color:#666">-</span>(LOCATED_IN)<span style="color:#666">-</span><span style="color:#666">&gt;</span>City<span style="color:#666">-</span>(IN_STATE)<span style="color:#666">-</span><span style="color:#666">&gt;</span>[<span style="color:#007020;font-weight:bold">State</span>])
<span style="color:#007020;font-weight:bold">group</span> <span style="color:#007020;font-weight:bold">by</span>
		[<span style="color:#007020;font-weight:bold">State</span>].[name]
<span style="color:#007020;font-weight:bold">order</span> <span style="color:#007020;font-weight:bold">by</span>
		[<span style="color:#007020">Number</span> <span style="color:#007020;font-weight:bold">of</span> Breweries] <span style="color:#007020;font-weight:bold">desc</span>

<span style="color:#60a0b0;font-style:italic">--Returns the count of breweries by city, state
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#007020;font-weight:bold">select</span>	[<span style="color:#007020;font-weight:bold">State</span>].[name] <span style="color:#007020;font-weight:bold">as</span> <span style="color:#4070a0">&#39;</span><span style="color:#4070a0">State</span><span style="color:#4070a0">&#39;</span>,
		City.[name] <span style="color:#007020;font-weight:bold">as</span> <span style="color:#4070a0">&#39;</span><span style="color:#4070a0">City</span><span style="color:#4070a0">&#39;</span>,
		<span style="color:#007020;font-weight:bold">count</span>(Brewery.id) <span style="color:#007020;font-weight:bold">as</span> <span style="color:#4070a0">&#39;</span><span style="color:#4070a0">Number of Breweries</span><span style="color:#4070a0">&#39;</span>
<span style="color:#007020;font-weight:bold">from</span>	graph.Brewery, graph.LOCATED_IN, graph.City, graph.IN_STATE, graph.[<span style="color:#007020;font-weight:bold">State</span>]
<span style="color:#007020;font-weight:bold">where</span>	<span style="color:#007020;font-weight:bold">match</span> (Brewery<span style="color:#666">-</span>(LOCATED_IN)<span style="color:#666">-</span><span style="color:#666">&gt;</span>City<span style="color:#666">-</span>(IN_STATE)<span style="color:#666">-</span><span style="color:#666">&gt;</span>[<span style="color:#007020;font-weight:bold">State</span>])
<span style="color:#007020;font-weight:bold">group</span> <span style="color:#007020;font-weight:bold">by</span>
		[<span style="color:#007020;font-weight:bold">State</span>].[name],
		City.[name]
<span style="color:#007020;font-weight:bold">order</span> <span style="color:#007020;font-weight:bold">by</span>
		[<span style="color:#007020">Number</span> <span style="color:#007020;font-weight:bold">of</span> Breweries] <span style="color:#007020;font-weight:bold">desc</span>
</code></pre></div><p>It‚Äôs important to note that Microsoft is starting to add graph extension to SQL Server, to make storing and querying graph data easier. These are the <!-- raw HTML omitted -->features<!-- raw HTML omitted --> that were introduced in this first release. Looking forward to the upcoming releases and explore what‚Äôs new in SQL Graph in SQL Server 2017.</p>
<p>Keep you posted<br>
Enjoy!</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->

      </div>

      <footer>
        


        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "stephanefrechettedev" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      </footer>
    </article>

    
  </section>

      </div>

      <footer class="footer">
  <section class="container">
    
     ¬© 2019 St√©phane Fr√©chette | <a href="https://stephanefrechette.dev/index.xml">Subscribe RSS</a> 
    
    
  </section>
</footer>

    </main>

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-137528572-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


  </body>

</html>
